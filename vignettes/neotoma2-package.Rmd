---
title: "The neotoma2 R Package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{The neotoma2 R Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(neotoma2)
```

## Neotoma Data Structure

Data in Neotoma is associated with sites, specific locations with lat/long coordinates. Within a site, there may be one or more **collection units**, which are locations at which samples are physically collected. For example, an archaeological **site** may have one or more **collection units**. These may have higher resolution GPS locations, but are considered to be part of the broader site. Within a **collection unit** data is collected at various **analysis units** from which **samples** are obtained.

Because Neotoma is made up of a number of constituent databases (e.g., the Indo-Pacific Pollen Database, NANODe), a set of **sample**s associated with a **collection unit** are assigned to a single **dataset** associated with a particular **dataset type** and **constituent database**.

We often begin by searching for sites within our particular study area, whether that is defined by geographic or political boundaries.

### Package Requirements

The `neotoma2` package draws primarily on `dplyr` and `purrr` packages from the `tidyverse`, and on the `sf` spatial data package.

## Site Searches

Sites can be searched using the `get_sites()` function, or, can be created using the `set_site()` function. A single `site` object is a special object in R, that can be combined into a `sites` object, effectively a `list()` of `site` objects.

### Finding a site

You can find a site by its unique numeric Neotoma site id (`x`), by name (`sitename`), by altitude (`altmin`, `altmax`), by geopolitical name (`gpid`), or by location (`loc`).

#### Using a Site ID

If we're looking for a site and we know its specific site identifier, we can use the simplest implementation of `get_sites()`:

```{r getSitex}
alexanderLake = get_sites(siteid=24)
alexanderLake
```

##### Using a Sitename

If we're looking for a site and we know its name or a part of its name, we can search using the function with the sitename argument, `get_site(sitename = )`:

```{r getsitename}
alexanderLake = get_sites(sitename = "Alexander Lake")
alexanderLake
```

We can also access the different parameters for each site using S4 class marker `@`.

Since the `sites` object is composed by smaller objects of class `site`, we do need to specify which ordered object we want to access. We do so with `[[ ]]` and place the index of the desired object.

```{r}
alexanderLake@sites[[1]]@siteid
```

##### Using an approximate name

If we just know part of the spelling of a sitename, we can use the `%` in the `sitename` argument operator to help us find the right option.

<<<<<<< HEAD
````{r getsitename placeholder}
alexanderSomething = get_sites(sitename = 'Alexander%')
```

Since this new `sites` object has 2 elements that belong to `site`, we can use S4 accessing techniques to gather the data for either the first or second object.


##### Accessing get_site documentation 

If we just know part of the spelling of a sitename, we can use the `%` in the `sitename` argument operator to help us find the right option.

````{r}
alexanderSomething = get_sites(sitename = 'Alexander%')
```


```{r}
# We mark [[1]] as we are entering the first site. 
alexanderSomething@sites[[2]]@sitename
```

##### Accessing get_site documentation 

If we ever need to see the documentation for examples, we can always access the help file using `?`

````{r getsites_documentation}
?get_sites
```

### Creating a Site

You can create a site with the `set_site` function. It will ask you to provide important information such as `sitename`, `lat`, and `long` attributes. 

```{r set_site}
my_site <- set_site(sitename="My Lake", coordinates = c(10, -30), description = "my lake", altitude = 30)
my_site
```

##### Accessing set_site documentation 

If we ever need to see the documentation for examples, we can always access the help file using `?`

````{r setsites_documentation}
?set_site
```

## Publications

Many Neotoma records have publications associated with them.  The `publication` object (and the `publications` collection) provide the opportunity to do this.  The [`publication`](http://open.neotomadb.org/dbschema/tables/publications.html) table in Neotoma contains an extensive number of fields.  The methods for `publications` in the `neotoma2` package provide us with tools to retrieve publication data from Neotoma, to set and manipulate publication data locally, and to retrieve publication data from external sources (e.g., using a DOI).

### `get_publication()` from Neotoma

Publications in Neotoma can be discovered using a number of parameters.  

The most simple case is a search for a publication based on one or more publication IDs.  Most people do not know the unique publication ID of individual articles, but this provides a simple method to highlight the way Neotoma retrieves and presents publication information.

#### Get Publication By ID

```{r}
```